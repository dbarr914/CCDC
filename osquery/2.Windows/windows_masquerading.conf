{
  "platform":"windows",
  "description":"ATT&CK: T1173,T1086,T1204,T1183",
  "queries":{
    "services.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='services.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='services.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "lsass.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='lsass.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='wininit.exe') AND LOWER(name)='lsass.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "svchost.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='services.exe') AND LOWER(name)='svchost.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='services.exe') AND LOWER(name)='svchost.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "cmd.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='cmd.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='cmd.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1173,T1204",
      "removed":false
    },
    "powershell.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='powershell.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='powershell.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1173,T1086,T1204",
      "removed":false
    },
    "notepad++.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad++.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad++.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "notepad.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='notepad.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "iexplore.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='iexplore.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='iexplore.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "firefox.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='firefox.exe') OR pid=(SELECT pid FROM processes WHERE parent!=(SELECT pid from processes where name='explorer.exe') AND LOWER(name)='firefox.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "chrome.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent != (SELECT pid from processes where name='explorer.exe') AND LOWER(name)='chrome.exe') OR pid=(SELECT pid FROM processes WHERE parent != (SELECT pid from processes where name='explorer.exe') AND LOWER(name)='chrome.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "conhost.exe_incorrect_parent_process":{
      "query":"SELECT name as bad_parent_child_name, pid bad_parent_child_pid FROM processes WHERE pid=(SELECT parent FROM processes WHERE parent != (SELECT pid from processes where name='csrss.exe') AND LOWER(name)='conhost.exe') OR pid=(SELECT pid FROM processes WHERE parent != (SELECT pid from processes where name='csrss.exe') AND LOWER(name)='conhost.exe');",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1204",
      "removed":false
    },
    "conhost.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='conhost.exe' AND LOWER(path)!='c:\\windows\\system32\\conhost.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "crss.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='crss.exe' AND LOWER(path)!='c:\\windows\\system32\\crss.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "explorer.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='explorer.exe' AND LOWER(path)!='c:\\windows\\explorer.exe' AND LOWER(path)!='c:\\windows\\syswow64\\explorer.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "dllhost.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='dllhost.exe' AND LOWER(path)!='c:\\windows\\system32\\dllhost.exe' AND LOWER(path)!='c:\\windows\\syswow64\\dllhost.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "lsass.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='lsass.exe' AND LOWER(path)!='c:\\windows\\system32\\lsass.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "services.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='services.exe' AND LOWER(path)!='c:\\windows\\system32\\services.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "smss.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='smss.exe' AND LOWER(path)!='c:\\windows\\system32\\smss.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "svchost.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='svchost.exe' AND LOWER(path)!='c:\\windows\\system32\\svchost.exe' AND LOWER(path)!='c:\\windows\\syswow64\\svchost.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "wininit.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='wininit.exe' AND LOWER(path)!='c:\\windows\\system32\\wininit.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "winlogon.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='winlogon.exe' AND LOWER(path)!='c:\\windows\\system32\\winlogon.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "wmiprvse.exe_incorrect_path":{
      "query":"SELECT * FROM processes WHERE LOWER(name)='wmiprvse.exe' AND LOWER(path)!='c:\\windows\\system32\\wbem\\wmiprvse.exe' AND LOWER(path)!='c:\\windows\\syswow64\\wbem\\wmiprvse.exe' AND path!='';",
      "interval":60,
      "description":"Detect processes masquerading as legitimate Windows processes - ATT&CK T1034",
      "removed":false
    },
    "Processes_no_binary_disk":{
      "query":"SELECT name, path, pid FROM processes WHERE on_disk = 0;",
      "interval":60,
      "description":"Detect Processes running without a binary on disk"
    }
  }
}
